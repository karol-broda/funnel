---
title: server cli & tls
icon: TerminalWindowIcon
description: a reference for all `funnel-server` command-line flags and how to configure tls.
---

import { Callout } from 'fumadocs-ui/components/callout';
import { Accordion, Accordions } from 'fumadocs-ui/components/accordion';
import { Tab, Tabs } from 'fumadocs-ui/components/tabs';

<Callout title="docker only" intent="warning">
the funnel server runs exclusively as a docker container for easy deployment and management.
</Callout>

## running the server

basic command to start the server:

```bash
docker run -d --name funnel-server [options] ghcr.io/karol-broda/funnel-server:latest
```

## configuration

<Accordions>
<Accordion title="Environment Variables">
| variable | default | description |
| --- | --- | --- |
| `FUNNEL_PORT` | `8080` | http traffic port |
| `FUNNEL_HOST` | `0.0.0.0` | host interface to bind |
| `FUNNEL_REQUIRE_AUTH` | `false` | require token authentication |
| `FUNNEL_TOKEN_STORE` | `/var/lib/funnel/tokens.json` | token storage file path |
| `FUNNEL_ENABLE_TLS` | `false` | enable automatic tls |
| `FUNNEL_TLS_PORT` | `8443` | https traffic port |
| `FUNNEL_LETSENCRYPT_EMAIL` | - | email for let's encrypt (required for tls) |
| `FUNNEL_CERT_DIR` | `/var/lib/funnel/certs` | certificate storage directory |
| `FUNNEL_DNS_PROVIDERS_CONFIG` | - | dns provider config path (required for tls) |
</Accordion>

<Accordion title="Command Line Flags">
alternatively, pass flags directly to the container:

| flag | shorthand | description |
| --- | --- | --- |
| `--port` | `-p` | http traffic port |
| `--require-auth` | - | require token authentication |
| `--token-store` | - | token storage file path |
| `--enable-tls` | - | enable automatic tls |
| `--tls-port` | - | https traffic port |
| `--letsencrypt-email` | - | email for let's encrypt |
| `--cert-dir` | - | certificate storage directory |
| `--dns-providers-config` | - | dns provider config path |
| `--help` | `-h` | show help |
</Accordion>
</Accordions>

## examples

basic server (no authentication):
```bash
docker run -d --name funnel-server -p 8080:8080 ghcr.io/karol-broda/funnel-server:latest
```

server with authentication:
```bash
docker run -d --name funnel-server \
  -p 8080:8080 \
  -v funnel-data:/var/lib/funnel \
  -e FUNNEL_REQUIRE_AUTH=true \
  ghcr.io/karol-broda/funnel-server:latest
```

server with custom port:
```bash
docker run -d --name funnel-server -p 9000:9000 -e FUNNEL_PORT=9000 ghcr.io/karol-broda/funnel-server:latest
```

## authentication

<Callout title="token-based auth" intent="info">
funnel supports api key-based authentication to control who can create tunnels.
</Callout>

### managing tokens

<Tabs items={['Create', 'List', 'Revoke']}>
<Tab value="Create">
```bash
# with docker
docker exec funnel-server funnel-server token create --name my-laptop

# output:
# Token created for "my-laptop"
#
#   sk_7Fj2kL9xMnPqRsTuVwXyZ0AbCdEfGhIj
#
#   Save this token now - it will NOT be shown again.
#   Token is persisted to disk and survives server restarts.
```

<Callout title="important" intent="warning">
save the token immediately - it cannot be retrieved later. only the hash is stored on the server.
</Callout>
</Tab>

<Tab value="List">
```bash
docker exec funnel-server funnel-server token list

# output:
# NAME                 PREFIX       CREATED
# ----                 ------       -------
# my-laptop            sk_7Fj2kL... 2 hours ago
# ci-pipeline          sk_x8Yz9W... 5 days ago
```
</Tab>

<Tab value="Revoke">
```bash
docker exec funnel-server funnel-server token revoke --name my-laptop

# output:
# Token "my-laptop" revoked.
```
</Tab>
</Tabs>

### token storage

tokens are hashed with sha-256 before storage. the token file is saved at `/var/lib/funnel/tokens.json` by default.

<Callout title="persistence" intent="tip">
mount a volume at `/var/lib/funnel` to persist tokens across container restarts.
</Callout>

## tls configuration

<Callout title="automatic tls" intent="info">
funnel automatically provisions and renews tls certificates from let's encrypt using the dns-01 challenge.
</Callout>

### setup steps

1. **create dns provider config** - see [lego documentation](https://go-acme.github.io/lego/dns/)

```json title="dns-providers.json"
{
  "providers": [
    {
      "name": "cloudflare",
      "env": {
        "CF_API_TOKEN": "your-cloudflare-api-token"
      }
    }
  ]
}
```

2. **start with tls enabled**

```bash
docker run -d --name funnel-server \
  -p 8080:8080 \
  -p 8443:8443 \
  -v $(pwd)/dns-providers.json:/etc/funnel/dns-providers.json \
  -v funnel-certs:/var/lib/funnel/certs \
  -e FUNNEL_ENABLE_TLS=true \
  -e FUNNEL_LETSENCRYPT_EMAIL=your-email@example.com \
  -e FUNNEL_DNS_PROVIDERS_CONFIG=/etc/funnel/dns-providers.json \
  ghcr.io/karol-broda/funnel-server:latest
```

certificates are generated automatically on first request and renewed before expiration. 